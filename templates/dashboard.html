<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>GRC Analytics — Lighthouse Technology</title>
  <link href="https://cdn.jsdelivr.net/npm/modern-css-reset/dist/reset.min.css" rel="stylesheet">
  <style>
    body{font-family:Inter,system-ui,Segoe UI,Roboto,Arial;background:#0b1220;color:#e6eef8;padding:18px}
    .container{max-width:1200px;margin:0 auto}
    header{display:flex;align-items:center;justify-content:space-between;margin-bottom:18px}
    h1{font-size:1.2rem;margin:0}
    .kpi-row{display:flex;gap:12px;flex-wrap:wrap;margin-bottom:18px}
    .kpi{background:linear-gradient(180deg,#071025,#071a2a);padding:14px;border-radius:8px;min-width:180px;flex:1;color:#dff1ff;box-shadow:0 6px 18px rgba(13,71,161,0.08)}
    .kpi .big{font-size:1.75rem;font-weight:700}
    .kpi .small{color:#8fb0e6}
    .tabs{display:flex;gap:8px;margin-bottom:12px}
    .tab{padding:8px 12px;border-radius:8px;background:rgba(255,255,255,0.02);cursor:pointer}
    .tab.active{background:linear-gradient(90deg,#0d47a1,#1565c0);color:#fff}
    .panel{background:#071025;padding:12px;border-radius:8px}
    .charts{display:grid;grid-template-columns:1fr 360px;gap:12px}
    @media (max-width:900px){ .charts{grid-template-columns:1fr} .kpi-row{flex-direction:column} .kpi{min-width:auto} }
    footer{margin-top:18px;color:#90b3ff;font-size:0.9rem}
  </style>
  <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
</head>
<body>
  <div class="container">
    <header>
      <div>
        <h1>GRC Analytics — Lighthouse Technology</h1>
        <div style="color:#90b3ff;font-size:0.9rem">Latest snapshot: {{ latest_date }} · Generated: {{ generated_at }}</div>
      </div>
      <div style="text-align:right;color:#8fb0e6;font-size:0.9rem">Data points: {{ total_points }}</div>
    </header>

    <section class="kpi-row" aria-label="Key performance indicators">
      <div class="kpi">
        <div class="small">Compliance (latest)</div>
        <div class="big">{{ compliance }}% <span style="font-size:0.9rem;color:#a7d3ff">({{ delta }}%)</span></div>
        <div class="small">Target: 90%</div>
      </div>

      <div class="kpi">
        <div class="small">Residual Risk (score)</div>
        <div class="big">{{ residual }}</div>
        <div class="small">Lower is better</div>
      </div>

      <div class="kpi">
        <div class="small">Open Audit Findings</div>
        <div class="big">{{ findings }}</div>
        <div class="small">Action owners assigned</div>
      </div>

      <div class="kpi">
        <div class="small">Control Effectiveness</div>
        <div class="big">{{ control_eff_pct }}%</div>
        <div class="small">Higher is better</div>
      </div>
    </section>

    <div class="tabs" role="tablist">
      <div class="tab active" data-panel="overview">Overview</div>
      <div class="tab" data-panel="trends">Trends</div>
      <div class="tab" data-panel="controls">Controls</div>
    </div>

    <section id="overview" class="panel">
      <div class="charts">
        <div id="plot-ts" style="min-height:360px;"></div>
        <div style="display:flex;flex-direction:column;gap:12px">
          <div id="plot-gauge" style="height:220px;"></div>
          <div id="plot-spark" style="height:90px;"></div>
        </div>
      </div>
    </section>

    <section id="trends" class="panel" style="display:none">
      <div id="plot-findings" style="min-height:420px;"></div>
      <div style="margin-top:12px;color:#9fbefc">Tip: hover charts to see exact values and dates.</div>
    </section>

    <section id="controls" class="panel" style="display:none">
      <h3 style="margin-top:0;color:#cfe7ff">Control Performance & Evidence</h3>
      <p style="color:#bcd9ff">Use this view to link control evidence, notes and action owners. You can export CSVs and attach redacted evidence snapshots.</p>
      <!-- small placeholder table -->
      <div style="background:rgba(255,255,255,0.02);padding:12px;border-radius:6px">
        <strong>Latest Control Note:</strong> Control effectiveness is trending up; schedule privileged access review.
      </div>
    </section>

    <footer>
      © 2025 LIGHT HOUSE TECHNOLOGY — Built by Bassey Solomon Henry · <a href="https://github.com/solomonhenry-afk/grc-analytics-engine" style="color:#a7d3ff">Repo</a>
    </footer>
  </div>

  <script>
    // parse JSON passed by Flask into Plotly
    const figs = {{ figs_json|tojson }};
    // each JSON is a Plotly figure (stringified JSON from plotly.io.to_json)
    Plotly.react('plot-ts', JSON.parse(figs.ts));   // main time series
    Plotly.react('plot-findings', JSON.parse(figs.findings));
    Plotly.react('plot-gauge', JSON.parse(figs.gauge));
    Plotly.react('plot-spark', JSON.parse(figs.spark));

    // tabs
    document.querySelectorAll('.tab').forEach(t => {
      t.addEventListener('click', () => {
        document.querySelectorAll('.tab').forEach(x=>x.classList.remove('active'));
        t.classList.add('active');
        const panel = t.dataset.panel;
        document.querySelectorAll('section.panel').forEach(p=>p.style.display='none');
        document.getElementById(panel).style.display = 'block';
      });
    });

    // mobile-friendly resize
    window.addEventListener('resize', () => {
      Plotly.Plots.resize('plot-ts');
      Plotly.Plots.resize('plot-findings');
      Plotly.Plots.resize('plot-gauge');
    });
  </script>
</body>
</html>
